
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Flask boilerplate">
      
      
      
        <link rel="canonical" href="https://github.com/oddbit-project/pokie/tutorial/tutorial/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.1.2">
    
    
      
        <title>Tutorial - Pokie</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f7951f6f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pokie-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Pokie" class="md-header__button md-logo" aria-label="Pokie" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pokie
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/oddbit-project/pokie/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    oddbit-project/pokie
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pokie" class="md-nav__button md-logo" aria-label="Pokie" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Pokie
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/oddbit-project/pokie/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    oddbit-project/pokie
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tutorial
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foreword" class="md-nav__link">
    Foreword
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presentation-layer" class="md-nav__link">
    Presentation layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-layer" class="md-nav__link">
    Service layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-layer" class="md-nav__link">
    Data layer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-scaffolding" class="md-nav__link">
    Application Scaffolding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initializing-the-application" class="md-nav__link">
    Initializing the application
  </a>
  
    <nav class="md-nav" aria-label="Initializing the application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-based-configuration" class="md-nav__link">
    Environment-based configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-based-configuration" class="md-nav__link">
    File-based configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-initialization" class="md-nav__link">
    Module initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory-initialization" class="md-nav__link">
    Factory initialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minimal-mainpy-example" class="md-nav__link">
    Minimal main.py example
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#foreword" class="md-nav__link">
    Foreword
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    Architecture
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presentation-layer" class="md-nav__link">
    Presentation layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-layer" class="md-nav__link">
    Service layer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-layer" class="md-nav__link">
    Data layer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-scaffolding" class="md-nav__link">
    Application Scaffolding
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initializing-the-application" class="md-nav__link">
    Initializing the application
  </a>
  
    <nav class="md-nav" aria-label="Initializing the application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#environment-based-configuration" class="md-nav__link">
    Environment-based configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-based-configuration" class="md-nav__link">
    File-based configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#module-initialization" class="md-nav__link">
    Module initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factory-initialization" class="md-nav__link">
    Factory initialization
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#minimal-mainpy-example" class="md-nav__link">
    Minimal main.py example
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/oddbit-project/pokie/edit/master/docs/tutorial/tutorial.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="pokie-tutorial">Pokie Tutorial</h1>
<h2 id="foreword">Foreword</h2>
<p>Pokie is built upon Dependency Injection and Resource Location. As such, dependencies are often specified by a full class
path string, instead of a direct import; coupling is inferred in runtime via provided configuration, instead of more
traditional approaches of using imports to provide dependencies. One of the main advantages of this approach is the
quasi-elimination of circular imports problem, and provides an elegant mechanism of overriding dependencies either at
load time or in runtime.</p>
<p>Pokie also makes heavy use of classes and namespaces, and often each class will reside in its own file; this requires more
discipline when scaffolding an application, and (sometimes) writing classes is more verbose than using more traditional
approaches. This is a calculated tradeoff by design, and not just a mere consequence of heavy pattern usage.</p>
<h2 id="architecture">Architecture</h2>
<p>Pokie promotes both <strong>two-tier</strong> and <strong>three-tier</strong> designs with heavy decoupling, in line with both 
<strong>clean architecture</strong> principles and <strong>onion architecture</strong> principles. The goal is to have only pure object records being carried
through the layers, such as <a href="https://oddbit-project.github.io/rick_db/object_mapper/">RickDB's DTO Objects</a>. Communication
is performed strictly top-down: each layer can only interect with the one immediately below,</p>
<p>A typical three-tier design has the following layers:</p>
<h3 id="presentation-layer">Presentation layer</h3>
<p>This is the level where Flask views are implemented, using class-based definitions; It is responsible for receiving requests, invoking dependencies, and
assembling responses; No specific business-related logic should reside here, adhering to the philosophy of "thin controllers".</p>
<p>As a default, these classes are instantiated as short-lived objects, and often only exist during the execution of a request, being 
destroyed afterwards. As such, all required initialization boilerplate must be as lightweight as possible. </p>
<p>To override this behaviour and allow for long-lived view objects, please refer to the Flask documentation.  </p>
<h3 id="service-layer">Service layer</h3>
<p>The service layer provides internal complex functionality to the presentation layer or for internal operation of the
application. Services are long-lived (by default atmost one instance created per service), but lazy-loaded - they are
only created if invoked for.</p>
<p>Services <strong>cannot interact</strong> with the Presentation layer; they are invoked (via service locator) from the Presentation layer; 
the service method signature may or may not be part of a formal interface, depending on design requirements.</p>
<p>Services <strong>can interact</strong> with other services, as well as with the data layer, immediately below. Also, it is quite common
to implement caching at the service level.</p>
<p>Keep in mind, services are - from a caller's perspective - stateless; they have no context of the application 
(eg. if its http or console, what is the current user session, etc), and all operations are - from a caller's perspective -
atomic. As such, if cache is implemented, it is up to the internal implementation of the service to ensure cache consistency
in such a way the service retains its stateless and context-less properties.</p>
<p>Services are invoked by a generic name, via a <strong>MapLoader</strong> object acting as a service locator. The service classes must
inherit the <strong>Injectable</strong> mixin. </p>
<h3 id="data-layer">Data layer</h3>
<p>The data layer provides basic data operations; this is often achieved by using <a href="https://oddbit-project.github.io/rick_db/repository/">RickDb's Repository</a>
pattern, and DTO classes and objects. Due to the nature of the DTO objects (data-only objects with no business logic or internal state),
these can be passed upwards into the presentation layer.</p>
<p>Repositories can either be short-lived or long-lived, depending how they are use inside services; the most common approach
is to have long-lived repositories defined as properties within the service.</p>
<p>The instantiation of a repository is direct, but other mechanisms can be used if a greater degree of decoupling is required.</p>
<h2 id="application-scaffolding">Application Scaffolding</h2>
<p>Pokie applications are organized in modules - contained in folders, and a startup script usually called main.py:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>my_project/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    project_module/
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        __init__.py
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        module.py  &lt;- the module initialization class
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    main.py        &lt;- the startup script
</code></pre></div>
<h2 id="initializing-the-application">Initializing the application</h2>
<p>To fully bootstrap the application, three components are required: the configuration container
(a <em>ShallowContainer</em> instance), the module list to be instantiated, and the factory list to be initialized.</p>
<p>The typical sequence of operations (both explicit and implicit) of a Pokie application is:</p>
<ul>
<li>load configuration; </li>
<li>build base Flask app; </li>
<li>load configured modules (instantiate Module objects only);</li>
<li>build a service map and initialize the Service Manager;</li>
<li>run factories defined in the factory list;</li>
<li>parse event definitions from modules and build the Event Manager;</li>
<li>initialize modules (by calling <em>build()</em> on each Module object);</li>
<li>run appropriate CLI wrapper, or pass app variable to a WSGI server;</li>
</ul>
<h3 id="configuration">Configuration</h3>
<p>Pokie manages configuration using Rick's configuration resources - it supports both environment-variable based configuration
or file-based configuration using JSON format. Both are parsed into a <em>ShallowContainer</em> object.</p>
<h4 id="environment-based-configuration">Environment-based configuration</h4>
<p>Environment-based configuration is a Docker-friendly mechanism to provide configurations; The configuration class extends
<em>EnvironmentConfig</em>, and when invoking build(), it attempts to read environment variables matching the existing <strong>uppercase-named 
class attributes</strong>. If a match is found, the default value is replaced. </p>
<p>In addition, if the default value is an object of type <em>StrOrFile</em>, it will consider the specified existing value a
path to a file containing the actual value. Any <em>StrOrFile</em> attribute with a computed value (either default or injected
via environment variables) that starts with <em>/</em> or <em>./</em> will be treated as a file to be read to determine the final value. </p>
<p><strong>Note:</strong> The return <em>ShallowContainer</em> object from <em>build()</em> will have <strong>all keys in lowercase</strong>, including the ones defined 
originally as uppercase. This allows the configuration class to have internal static configuration attributes that are
not injectable from environment variables.</p>
<p>Minimal Pokie environment-based configuration example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">rick.resource.config</span> <span class="kn">import</span> <span class="n">EnvironmentConfig</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">pokie.config.template</span> <span class="kn">import</span> <span class="n">BaseConfigTemplate</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># minimal Pokie environment-based configuration</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c1"># Pokie&#39;s defaults come from BaseConfigTemplate</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">EnvironmentConfig</span><span class="p">,</span> <span class="n">BaseConfigTemplate</span><span class="p">):</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="k">pass</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="c1"># load configuration and return a ShallowContainer</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</code></pre></div>
<h4 id="file-based-configuration">File-based configuration</h4>
<p>File-based configuration is comparatively simpler, as all values are read from the specified file. However, default values
for settings need also to exist on the file, resulting in more complex files.</p>
<p>Minimal Pokie file-based configuration example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">rick.resource.config</span> <span class="kn">import</span> <span class="n">json_file</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># load configuration from file and return a ShallowContainer</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">cfg</span> <span class="o">=</span> <span class="n">json_file</span><span class="p">(</span><span class="s1">&#39;config.json&#39;</span><span class="p">)</span>
</code></pre></div>
<p>config.json contents:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;modules&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nt">&quot;use_auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">  </span><span class="nt">&quot;auth_plugins&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pokie.contrib.auth.plugin.DbAuthPlugin&quot;</span><span class="p">],</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">  </span><span class="nt">&quot;auth_secret&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;very_secret_key&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">  </span><span class="nt">&quot;db_cache_metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></p>
<h3 id="module-initialization">Module initialization</h3>
<p>Bootstrapping a Pokie application requires a list of modules to be initialized; Each element of the list is a string with
a python class path for the module itself; Each module directory must then contain a <em>Module</em> class that inherits from
<em>BaseModule</em>, inside a file called <em>module.py</em>. This is the initialization class for a given module.</p>
<p>The list of modules to be initialized can also be provided via configuration setting, depending on the desired implementation.</p>
<h3 id="factory-initialization">Factory initialization</h3>
<p>Factories are assorted initializers for several purposes. One of them is to provide lazy loading mechanisms for
database connections or cache connections. The factory list is a list of direct classes (python classes, not strings).</p>
<h2 id="minimal-mainpy-example">Minimal main.py example</h2>
<p>The main.py script is usually a simple file, containing the previously mentioned components. In addition, it should
also provide the cli wrapper, to automatically also be able to execute cli operations. To enable this feature, just add
this to the bottom of the file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    <span class="n">main</span><span class="o">.</span><span class="n">cli</span><span class="p">()</span>
</code></pre></div>
<p>A minimal  but complete main.py example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">rick.resource.config</span> <span class="kn">import</span> <span class="n">EnvironmentConfig</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">from</span> <span class="nn">pokie.config.template</span> <span class="kn">import</span> <span class="n">BaseConfigTemplate</span><span class="p">,</span> <span class="n">PgConfigTemplate</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">from</span> <span class="nn">pokie.core</span> <span class="kn">import</span> <span class="n">FlaskApplication</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kn">from</span> <span class="nn">pokie.core.factories.pgsql</span> <span class="kn">import</span> <span class="n">PgSqlFactory</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="c1"># base configuration</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">EnvironmentConfig</span><span class="p">,</span> <span class="n">BaseConfigTemplate</span><span class="p">,</span> <span class="n">PgConfigTemplate</span><span class="p">):</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    <span class="k">pass</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c1"># load configuration from ENV</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="n">cfg</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="c1"># modules to load &amp; initialize:</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="c1"># the internal auth module, and a custom-defined local module called &#39;my_module&#39;</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="n">modules</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pokie.contrib.auth&#39;</span><span class="p">,</span> <span class="s1">&#39;my_module&#39;</span><span class="p">]</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="c1"># factories to run</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="c1"># the postgresql initializer, and the flask-login initializer</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="n">factories</span> <span class="o">=</span> <span class="p">[</span><span class="n">PgSqlFactory</span><span class="p">,</span> <span class="n">FlaskLogin</span><span class="p">,</span> <span class="p">]</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="c1"># build Pokie application</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="n">main</span> <span class="o">=</span> <span class="n">FlaskApplication</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="c1"># bootstrap Pokie application</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="c1"># the returned object is a Flask application</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="n">app</span> <span class="o">=</span> <span class="n">main</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">modules</span><span class="p">,</span> <span class="n">factories</span><span class="p">)</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a><span class="c1"># if it is a cli invocation</span>
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    <span class="c1"># run the cli wrapper</span>
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="n">main</span><span class="o">.</span><span class="n">cli</span><span class="p">()</span>
</code></pre></div></p>
<p>For development purposes, the application can be run directly:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$ python3 main.py runserver
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a> * Serving Flask app <span class="s1">&#39;FlaskApplication&#39;</span> <span class="o">(</span>lazy loading<span class="o">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a> * Environment: production
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>   WARNING: This is a development server. Do not use it <span class="k">in</span> a production deployment.
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>   Use a production WSGI server instead.
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a> * Debug mode: off
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>INFO:werkzeug: * Running on http://127.0.0.1:5000 <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
</code></pre></div></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../.." class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.649a939e.min.js"></script>
      
    
  </body>
</html>